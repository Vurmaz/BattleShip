(()=>{"use strict";const t=document.querySelector(".player"),e=document.querySelector(".opponent"),s=document.querySelector(".pop"),i=document.querySelectorAll(".table"),r=class{constructor(t,e){this.name=t,this.length=e,this.isHorizantal=!0,this.coord=[],this.hits=[]}hit(t){this.hits.push(t)}isSunk(){return!!this.coord.every((t=>this.hits.includes(t)))}},o=class{constructor(t){this.name=t,this.gameboard=new class{constructor(){this.board=[],this.ships=[],this.missed=[],this.allHits=[],this.shipPositions=[]}createBoard(){for(let t=0;t<100;t++)this.board.push(t)}createGameBoard(){const t=document.createElement("div");return t.classList.add("piece"),t}placeShip(t,e){if(t.isHorizantal){let s=[],i=0;for(;i<t.length;)s.push(e),e++,i++;t.coord=[...s],this.shipPositions.push(s),this.ships.push(t)}else{let s=0,i=[];for(;s<t.length;)i.push(e),e+=10,s++;t.coord=[...i],this.shipPositions.push(i),this.ships.push(t)}}recieveAttack(t){this.allHits.push(t),this.shipPositions.forEach((e=>{e.includes(t)?this.ships.forEach((e=>{e.hit(t)})):this.missed.push(t)}))}isAllShipsSunked(){return!!this.ships.every((t=>t.isSunk()))}makeRandomMoves(){let t=Math.floor(100*Math.random());this.recieveAttack(t)}isPositionValid(t,e){if(t.isHorizantal)return e%10!=10-(t.length-1)&&e%10!=10-(t.length-2)&&e%10!=10-(t.length-3)&&e%10!=10-(t.length-4);if(!t.isHorizantal){if(String(e)[0]!=10-(t.length-1)&&String(e)[0]!=10-(t.length-2)&&String(e)[0]!=10-(t.length-3)&&String(e)[0]!=10-(t.length-4))return!0;{let t=[];for(let s=e;s<100;s++)t.push(s);if(t.includes(e))return!1}}}hasPositionShip(t,e){if(t.isHorizantal){let s=0,i=[];for(;s<t.length;)i.push(this.shipPositions.some((t=>t.includes(e)))),e++,s++;return!i.includes(!0)}if(!t.isHorizantal){let s=0,i=[];for(;s<t.length;)i.push(this.shipPositions.some((t=>t.includes(e)))),e+=10,s++;return!i.includes(!0)}}},this.isTurn=!1}createPlayBoard(t){this.gameboard.createBoard();for(let e=0;e<this.gameboard.board.length;e++)t.appendChild(this.gameboard.createGameBoard())}},a=new o("Human"),n=new o("Computer"),h=new r("destroyer",2),c=new r("submarine",3),l=new r("cruiser",3),d=new r("battleShip",4),u=new r("carrier",5),f=new r("destroyer",2),m=new r("submarine",3),p=new r("cruiser",3),g=new r("battleShip",4),y=new r("carrier",5),v=document.querySelector(".player"),S=document.querySelector(".opponent"),L=document.querySelector(".replacement"),E=document.querySelector(".rotate"),b=document.querySelector(".winnerPop"),P=b.querySelector("h1"),M=document.querySelector(".overlay");async function w(t,e,s){(e[s].classList.contains("hit")||e[s].classList.contains("shot"))&&w(t,e,Math.floor(100*Math.random())),setTimeout(k(t,e,s),2e3)}function k(t,e,s){e[s].classList.contains("hit")||(t.gameboard.recieveAttack(s),function(t,e){let s;return t.gameboard.shipPositions.forEach((t=>{t.includes(e)&&(s=!0)})),s}(t,s)?(e[s].classList.remove("hide"),e[s].classList.add("shot")):e[s].classList.add("hit"))}function q(t,e){t.gameboard.isAllShipsSunked()&&(b.classList.add("show"),M.classList.add("overlay-active"),P.innerText=`${e.name} Wins`)}function A(t){a.gameboard.ships.forEach((e=>{e.isSunk()&&e.coord.forEach((e=>t[e].classList.add("sunked")))}))}const H=L.querySelectorAll(".pie"),z=Array.from(H);function B(t){if(z.forEach((t=>t.classList.remove("hvr"))),t.isHorizantal){let e=[];L.addEventListener("mouseover",(s=>{z.forEach((t=>t.classList.remove("hvr")));let i=0;for(let r=0;r<z.length;r++)if(s.target==z[r]&&a.gameboard.isPositionValid(t,r)&&a.gameboard.hasPositionShip(t,r))for(;i<t.length;)z[r].classList.add("hvr"),e.push(r),r++,i++})),L.addEventListener("mouseout",(()=>{e.forEach((t=>{z[t].classList.remove("hvr")}))}))}else{let e=[];L.addEventListener("mouseover",(s=>{z.forEach((t=>t.classList.remove("hvr")));let i=0;for(let r=0;r<z.length;r++)if(s.target==z[r]&&a.gameboard.isPositionValid(t,r)&&a.gameboard.hasPositionShip(t,r))for(;i<t.length;)z[r].classList.add("hvr"),e.push(r),r+=10,i++})),L.addEventListener("mouseout",(()=>{e.forEach((t=>{z[t].classList.remove("hvr")}))}))}}function V(t){E.addEventListener("click",(()=>{t.isHorizantal=!t.isHorizantal,B(t)}))}function T(t,e,s){e.isHorizantal=Math.random()<.5,C(t,e,s)?x(t,e,s):T(t,e,Math.floor(100*Math.random()))}function x(t,e,s){const i=Array.from(v.children),r=Array.from(S.children);!function(t,e,s){t.gameboard.placeShip(e,s)}(t,e,s),a.gameboard.shipPositions.forEach((t=>{t.forEach((t=>{z[t].classList.add("ship")}))})),R(a,i),R(n,r)}function C(t,e,s){return!!function(t,e,s){return!(!t.gameboard.isPositionValid(e,s)||(i=s,z[i].classList.contains("ship"))||!t.gameboard.hasPositionShip(e,s));var i}(t,e,s)}function G(t){n.gameboard.shipPositions.forEach((e=>{e.forEach((e=>{t[e].classList.add("hide")}))}))}function R(t,e){t.gameboard.shipPositions.forEach((t=>{t.forEach((t=>{e[t].classList.add("ship")}))}))}a.createPlayBoard(v),n.createPlayBoard(S),function(){const r=Array.from(S.children);let o=0;0==o&&(V(u),B(u)),L.addEventListener("click",(v=>{for(let S=0;S<z.length;S++)v.target==z[S]&&(0==o?(V(d),B(d),C(a,u,S)&&(x(a,u,S),T(n,y,Math.floor(100*Math.random())),o++)):1==o?(V(l),B(l),C(a,d,S)&&(x(a,d,S),T(n,g,Math.floor(100*Math.random())),o++)):2==o?(V(c),B(c),C(a,l,S)&&(x(a,l,S),T(n,p,Math.floor(100*Math.random())),o++)):3==o?(V(h),B(h),C(a,c,S)&&(x(a,c,S),T(n,m,Math.floor(100*Math.random())),o++)):4==o&&C(a,h,S)&&(x(a,h,S),T(n,f,Math.floor(100*Math.random())),G(r),s.style.display="none",t.style.display="grid",e.style.display="grid",i.forEach((t=>{t.style.display="flex"})),o++))}))}(),function(){const t=Array.from(v.children),e=Array.from(S.children);for(let s=0;s<100;s++)S.addEventListener("click",(i=>{if(i.target==e[s]){if(e[s].classList.contains("hit")||e[s].classList.contains("shot"))return;k(n,e,s),r=e,n.gameboard.ships.forEach((t=>{t.isSunk()&&t.coord.forEach((t=>r[t].classList.add("sunked")))})),q(n,a),w(a,t,Math.floor(100*Math.random())),A(t),q(a,n)}var r}))}(),document.querySelector(".restart").addEventListener("click",(()=>{window.location.reload()}))})();